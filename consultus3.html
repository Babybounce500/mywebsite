<!DOCTYPE html>
<html>
<head>
  <title>Aktienkurs Analyse und Positionsgröße</title>
  <script>
    function getRandomKurs() {
      // Generiere eine zufällige Kurszahl zwischen 50 und 200
      return (Math.random() * (200 - 50) + 50).toFixed(2);
    }

    function analyzeStocks() {
      // Werte aus den Eingabefeldern für die Aktienanalyse auslesen
      var aktienname = document.getElementById("aktienname").value;
      var kursA = parseFloat(document.getElementById("kursA").value);
      var kursB = parseFloat(document.getElementById("kursB").value);
      var kursC = parseFloat(document.getElementById("kursC").value);
      var dauer = document.getElementById("dauer").value;

      // Börsenanalyse durchführen
      var diffAB = Math.abs(kursA - kursB); // Absolute Differenz von A und B
      var diffCB = Math.abs(kursC - kursB); // Absolute Differenz von C und B

      // Ergebnis anzeigen
      var result;
      if (diffAB < diffCB) {
        result = "GO";
      } else {
        result = "NO";
      }
      document.getElementById("result").innerHTML = result;

      // Tabelle aktualisieren
      if (result === "GO") {
        var ergebnisTable = document.getElementById("ergebnisTable");
        var newRow = ergebnisTable.insertRow(-1);
        var aktiennameCell = newRow.insertCell(0);
        var longCell = newRow.insertCell(1);
        var shortCell = newRow.insertCell(2);
        var kursrisikoCell = newRow.insertCell(3);
        var stückzahlCell = newRow.insertCell(4);
        var terminCell = newRow.insertCell(5);

        aktiennameCell.innerHTML = aktienname;
        longCell.innerHTML = Math.max(kursA, kursB, kursC);
        shortCell.innerHTML = Math.min(kursA, kursB, kursC);
        kursrisikoCell.innerHTML = (parseFloat(longCell.innerHTML) - parseFloat(shortCell.innerHTML)).toFixed(2);
        
        // Setze den Termin basierend auf der ausgewählten Dauer
        var currentDate = new Date();
        if (dauer === "3 Tage") {
          currentDate.setDate(currentDate.getDate() + 3);
        } else if (dauer === "3 Wochen") {
          currentDate.setDate(currentDate.getDate() + 21);
        } else if (dauer === "3 Monate") {
          currentDate.setMonth(currentDate.getMonth() + 3);
        }
        terminCell.innerHTML = currentDate.toISOString().slice(0, 10); // Zeige das Datum im Format JJJJ-MM-TT an

        // Markiere die Spalte "Stückzahl" als offen, um die Positionsgröße später zu berechnen
        stückzahlCell.setAttribute("data-open", "true");
      }

      // Textfelder zurücksetzen
      document.getElementById("aktienname").value = "";
      document.getElementById("kursA").value = "";
      document.getElementById("kursB").value = "";
      document.getElementById("kursC").value = "";
      document.getElementById("dauer").value = "3 Tage"; // Setze die Auswahl zurück auf "3 Tage"
    }

    function calculatePositionSize() {
      // Werte aus den Eingabefeldern für die Positionsgrößenberechnung auslesen
      var kontostand = parseFloat(document.getElementById("kontostand").value.replace(",", "."));
      var kursrisiko = parseFloat(document.getElementById("kursrisiko").value.replace(",", "."));

      // Positionsgröße (Stückzahl) berechnen und auf die nächste kleinere ganze Zahl abrunden
      var prozentsatz = 1; // 1% des Kontostands
      var stückzahl = Math.floor((kontostand * prozentsatz / 100) / kursrisiko);

      // Ergebnis anzeigen
      document.getElementById("stückzahl").innerHTML = stückzahl;
      document.getElementById("aktuellKontostand").innerHTML = kontostand.toFixed(2);

      // Aktualisiere die Zelle in der Tabelle bei "Stückzahl", wenn die Spalte als offen markiert ist
      var stückzahlCell = document.querySelector("[data-open='true']");
      if (stückzahlCell) {
        stückzahlCell.innerHTML = stückzahl;
        stückzahlCell.removeAttribute("data-open");
      }
    }
  </script>
</head>
<body>
  <h1>CONSULTUS</h1>
  <p>Kursdaten auf<a href="https://www.comdirect.de">Comdirect.de</a>.</p>
  <h2>Aktienkurs Analyse</h2><p>Kurs A = letzter Close / Kurs B = vorletzter Close / Kurs C = drittletzter Close</p>
  <p>Wenn Dauer 3 Tage, dann Tagesschlusskurse verwenden. Wenn Dauer 3Wochen, dann Wochenschlusskurs verwenden, Wenn Dauer 3 Monate, dann Wochenschlusskurs verwenden</p>
  <label for="aktienname">Aktienname:</label>
  <input type="text" id="aktienname" name="aktienname"><br>

  <label for="kursA">Kurs A:</label>
  <input type="number" step="0.01" id="kursA"><br>

  <label for="kursB">Kurs B:</label>
  <input type="number" step="0.01" id="kursB"><br>

  <label for="kursC">Kurs C:</label>
  <input type="number" step="0.01" id="kursC"><br>
  
  <label for="dauer">Dauer:</label>
  <select id="dauer">
    <option value="3 Tage">3 Tage</option>
    <option value="3 Wochen">3 Wochen</option>
    <option value="3 Monate">3 Monate</option>
  </select><br>

  <button onclick="analyzeStocks()">Aktienanalyse durchführen</button>

  <p>Ergebnis: <span id="result"></span></p>

  <table id="ergebnisTable">
    <tr>
      <th>Aktienname</th>
      <th>LONG</th>
      <th>SHORT</th>
      <th>Kursrisiko</th>
      <th>Stückzahl</th>
      <th>Termin</th>
    </tr>
  </table>

  <h2>Positionsgröße</h2>
  <label for="kontostand">Kontostand:</label>
  <input type="text" id="kontostand"><br>

  <label for="kursrisiko">Kursrisiko:</label>
  <input type="text" id="kursrisiko"><br>

  <button onclick="calculatePositionSize()">Positionsgröße berechnen</button>

  <p>Aktueller Kontostand: <span id="aktuellKontostand"></span></p>
  <p>
    <p>Positionsgröße (Stückzahl): <span id="stückzahl"></span></p>
  </body>
  </html>
  <!DOCTYPE html>
<html>
<head>
    <title>CONSULTING Gewinnmitnahme </title>
</head>
<body>
    <h1>Gewinnmitnahme</h1>
    <form id="stockForm">
        <label for="stockName">Aktienname:</label>
        <input type="text" id="stockName" required><br>

        <label for="currentPrice">Aktueller Kurs:</label>
        <input type="number" step="0.01" id="currentPrice" required><br>

        <label for="entryPrice">Einstiegskurs:</label>
        <input type="number" step="0.01" id="entryPrice" required><br>

        <label for="accountBalance">Kontostand:</label>
        <input type="number" step="0.01" id="accountBalance" required><br>

        <input type="button" value="Berechnen" onclick="calculate()"><br>

        <label for="riskUnit">1R:</label>
        <span id="riskUnitResult"></span><br>

        <label for="newQuantity">Neue Stückzahl:</label>
        <span id="newQuantityResult"></span><br>
    </form>

    <script>
        function calculate() {
            const currentPrice = parseFloat(document.getElementById("currentPrice").value);
            const entryPrice = parseFloat(document.getElementById("entryPrice").value);
            const accountBalance = parseFloat(document.getElementById("accountBalance").value);

            // Berechnung 1R (1% des Kontostands)
            const onePercentOfBalance = 0.01 * accountBalance;
            document.getElementById("riskUnitResult").innerText = onePercentOfBalance.toFixed(2) + " EUR";

            // Berechnung der neuen Stückzahl
            const riskAmount = onePercentOfBalance / (currentPrice - entryPrice);
            document.getElementById("newQuantityResult").innerText = Math.floor(riskAmount) + " Stück";
        }
    </script>
</body>
</html>